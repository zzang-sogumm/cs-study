# ğŸ‘€ ì˜µì €ë²„ íŒ¨í„´ (observer pattern)

> ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆëŠ” ì£¼ì²´ ê°ì²´ & ìƒíƒœì˜ ë³€ê²½ì„ ì•Œì•„ì•¼ í•˜ëŠ” ê´€ì°° ê°ì²´

- ì„œë¡œì˜ **ì •ë³´ë¥¼ ì£¼ê³ ë°›ëŠ” ê³¼ì •**ì—ì„œ ì •ë³´ì˜ ë‹¨ìœ„ê°€ í´ìˆ˜ë¡, ê°ì²´ë“¤ì˜ **ê·œëª¨ê°€ í´ìˆ˜ë¡ ë³µì¡ì„±ì´ ì¦ê°€**í•˜ê²Œ ë¨
- ì´ë•Œ ê°€ì´ë“œë¼ì¸ì„ ì œì‹œí•´ì¤„ ìˆ˜ ìˆëŠ” ê²ƒì´ 'ì˜µì €ë²„ íŒ¨í„´'

- ì£¼ì²´ê°€ ì–´ë–¤ ê°ì²´(subject)ì˜ ìƒíƒœ ë³€í™”ë¥¼ ê´€ì°°í•˜ë‹¤ê°€ **ìƒíƒœ ë³€í™”ê°€ ìˆì„ ë•Œë§ˆë‹¤** ë©”ì„œë“œ ë“±ì„ í†µí•´ ì˜µì €ë²„ ëª©ë¡ì— ìˆëŠ” ì˜µì €ë²„ë“¤ì—ê²Œ ë³€í™”ë¥¼ ì•Œë ¤ì£¼ëŠ” ë””ìì¸ íŒ¨í„´

> - ì£¼ì²´: ê°ì²´ì˜ ìƒíƒœ ë³€í™”ë¥¼ ë³´ê³  ìˆëŠ” ê´€ì°°ì
> - ì˜µì €ë²„ë“¤: ì´ ê°ì²´ì˜ ìƒíƒœ ë³€í™”ì— ë”°ë¼ ì „ë‹¬ë˜ëŠ” ë©”ì„œë“œ ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ 'ì¶”ê°€ ë³€í™”ì‚¬í•­'ì´ ìƒê¸°ëŠ” ê°ì²´ë“¤ì„ ì˜ë¯¸í•¨
> - ì£¼ì²´ì™€ ê°ì²´ë¥¼ ë”°ë¡œ ë‘ì§€ ì•Šê³  ìƒíƒœê°€ ë³€ê²½ë˜ëŠ” ê°ì²´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•í•˜ê¸°ë„ í•¨

## ğŸ˜ï¸ ì˜ˆì‹œ

- ì˜µì €ë²„ íŒ¨í„´ì„ í™œìš©í•œ ì„œë¹„ìŠ¤ ì˜ˆì‹œ: `íŠ¸ìœ„í„°`
  - ë‚´ê°€ ì–´ë–¤ ì‚¬ëŒì¸ ì£¼ì²´ë¥¼ 'íŒ”ë¡œìš°'í–ˆë‹¤ë©´ ì£¼ì²´ê°€ í¬ìŠ¤íŒ…ì„ ìš¸ë¦¬ê²Œ ë˜ë©´ ì•Œë¦¼ì´ 'íŒ”ë¡œì›Œ'ì—ê²Œ ê°€ì•¼í•¨
- ì˜µì €ë²„ íŒ¨í„´ì€ ì£¼ë¡œ `ì´ë²¤íŠ¸ ê¸°ë°˜ ì‹œìŠ¤í…œ`ì— ì‚¬ìš©í•˜ë©° `MVC(Model-View-Controller) íŒ¨í„´`ì—ë„ ì‚¬ìš©ë¨
  - ì˜ˆë¥¼ ë“¤ì–´ ì£¼ì²´ë¼ê³  ë³¼ ìˆ˜ ìˆëŠ” ëª¨ë¸(model)ì—ì„œ ë³€ê²½ ì‚¬í•­ì´ ìƒê²¨ update() ë©”ì„œë“œë¡œ ì˜µì €ë²„ì¸ ë·°ì— ì•Œë ¤ì£¼ê³  ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬(controller) ë“±ì´ ì‘ë™í•˜ëŠ” ê²ƒ

### âœï¸ ìë°”ì—ì„œì˜ ì˜µì €ë²„ íŒ¨í„´

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile9.uf.tistory.com%2Fimage%2F2214233B56A4D98611449A" />

#### Publisher ì¸í„°í˜ì´ìŠ¤

> Observerë“¤ì„ ê´€ë¦¬í•˜ëŠ” ë©”ì†Œë“œë¥¼ ê°€ì§€ê³  ìˆìŒ

- ì˜µì €ë²„ ë“±ë¡(add), ì œì™¸(delete), ì˜µì €ë²„ë“¤ì—ê²Œ ì •ë³´ë¥¼ ì•Œë ¤ì¤Œ(notifyObserver)

```java
public interface Publisher {
public void add(Observer observer);
public void delete(Observer observer);
public void notifyObserver();
}
```

#### Observer ì¸í„°í˜ì´ìŠ¤

ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸(update)

```java
public interface Observer {
public void update(String title, String news); }
```

#### NewsMachine í´ë˜ìŠ¤

Publisherë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¡œ, ì •ë³´ë¥¼ ì œê³µí•´ì£¼ëŠ” í¼ë¸”ë¦¬ì…”ê°€ ë¨

```java
public class NewsMachine implements Publisher {
private ArrayList<Observer> observers;
private String title;
private String news;

    public NewsMachine() {
        observers = new ArrayList<>();
    }

    @Override
    public void add(Observer observer) {
        observers.add(observer);
    }

    @Override
    public void delete(Observer observer) 	{
        int index = observers.indexOf(observer);
        observers.remove(index);
    }

    @Override
    public void notifyObserver() {
        for(Observer observer : observers) {
           observer.update(title, news);
        }
    }

    public void setNewsInfo(String title, String news) {
        this.title = title;
        this.news = news;
        notifyObserver();
    }

    public String getTitle() { return title; }
    public String getNews() { return news; }

}
```

#### AnnualSubscriber, EventSubscriber í´ë˜ìŠ¤

Observerë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë“¤ë¡œ, notifyObserver()ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì•Œë ¤ì¤„ ë•Œë§ˆë‹¤ Updateê°€ í˜¸ì¶œë¨

```java
public class EventSubscriber implements Observer {

    private String newsString;
    private Publisher publisher;

    public EventSubscriber(Publisher publisher) {
        this.publisher = publisher;
        publisher.add(this);
    }

    @Override
    public void update(String title, String news) {
        newsString = title + " " + news;
        display();
    }

    public void withdraw() {
        publisher.delete(this);
    }

    public void display() {
        System.out.println("ì´ë²¤íŠ¸ ìœ ì €");
        System.out.println(newsString);
    }
}
```

#### ìë°”: ìƒì†ê³¼ êµ¬í˜„

1. ìƒì†

   - ìƒì†(extends)ì€ ìì‹ í´ë˜ìŠ¤ê°€ ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œ ë“±ì„ ìƒì†ë°›ì•„ ì‚¬ìš©í•˜ë©° ìì‹ í´ë˜ìŠ¤ì—ì„œ ì¶”ê°€ ë° í™•ì¥ì„ í•  ìˆ˜ ìˆëŠ” ê²ƒ
   - ì´ë¡œ ì¸í•´ ì¬ì‚¬ìš©ì„±, ì¤‘ë³µì„±ì˜ ìµœì†Œí™”ê°€ ì´ë£¨ì–´ì§

2. êµ¬í˜„

   - ë¶€ëª¨ ì¸í„°í˜ì´ìŠ¤(interface)ë¥¼ ìì‹ í´ë˜ìŠ¤ì—ì„œ ì¬ì •ì˜í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ê²ƒì„ ë§í•¨
   - ìƒì†ê³¼ëŠ” ë‹¬ë¦¬ ë°˜ë“œì‹œ ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•˜ì—¬ êµ¬í˜„í•´ì•¼ í•¨

3. ìƒì†ê³¼ êµ¬í˜„ì˜ ì°¨ì´

   - ìƒì†ì€ ì¼ë°˜ í´ë˜ìŠ¤, abstract í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„í•¨
   - êµ¬í˜„ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„í•¨

### âœï¸ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œì˜ ì˜µì €ë²„ íŒ¨í„´

- í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ êµ¬í˜„í•  ìˆ˜ë„ ìˆìŒ

#### í”„ë¡ì‹œ ê°ì²´

- í”„ë¡ì‹œ(proxy) ê°ì²´ëŠ” ì–´ë– í•œ ëŒ€ìƒì˜ ê¸°ë³¸ì ì¸ ë™ì‘(ì†ì„± ì ‘ê·¼, í• ë‹¹, ìˆœíšŒ, ì—´ê±°, í•¨ìˆ˜ í˜¸ì¶œ ë“±)ì˜ ì‘ì—…ì„ ê°€ë¡œì±Œ ìˆ˜ ìˆëŠ” ê°ì²´ë¥¼ ëœ»í•˜ë©°, ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í”„ë¡ì‹œ ê°ì²´ëŠ” ë‘ ê°œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ì§

- target: í”„ë¡ì‹œí•  ëŒ€ìƒ
- handler: targetë™ì‘ì„ ê°€ë¡œì±„ê³  ì–´ë– í•œ ë™ì‘ì„ í•  ê²ƒì¸ì§€ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ” í•¨ìˆ˜

- í”„ë¡ì‹œ ê°ì²´ë¥¼ êµ¬í˜„í•œ ì½”ë“œ

```js
const handler = {
  get: function (target, name) {
    return name === "name" ? `${target.a} ${target.b}` : target[name];
  },
};
const p = new Proxy({ a: "KUNDOL", b: "IS AUMUMU ZANGIN" }, handler);
console.log(p.name); // KUNDOL IS AUMUMU ZANGIN
```

- new Proxy()ë¡œ aì™€ b ì†ì„±ì„ ê°€ì§€ê³  ìˆëŠ” ê°ì²´ì™€ handler í•¨ìˆ˜ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ê³  pë¼ëŠ” ë³€ìˆ˜ë¥¼ ì„ ì–¸í•¨
- ì´í›„ pì˜ name ì†ì„±ì„ ì°¸ì¡°í•˜ë‹ˆ aì™€ bë¼ëŠ” ì†ì„±ë°–ì— ì—†ëŠ” ê°ì²´ê°€ handlerì˜ "name"ì´ë¼ëŠ” ì†ì„±ì— ì ‘ê·¼í•  ë•Œ aì™€ bë¥¼ í•©ì³ì„œ ë¬¸ìì—´ì„ ë§Œë“¤ë¼"ëŠ” ë¡œì§ì— ë”°ë¼ ì–´ë–¤ ë¬¸ìì—´ì„ ë§Œë“¬
- ì´ë ‡ê²Œ name ì†ì„± ë“± íŠ¹ì • ì†ì„±ì— ì ‘ê·¼í•  ë•Œ ê·¸ ë¶€ë¶„ì„ ê°€ë¡œì±„ì„œ ì–´ë– í•œ ë¡œì§ì„ ê°•ì œí•  ìˆ˜ ìˆëŠ” ê²ƒì´ í”„ë¡ì‹œ ê°ì²´ì„

#### í”„ë¡ì‹œ ê°ì²´ë¥¼ ì´ìš©í•œ ì˜µì €ë²„ íŒ¨í„´

```js
function createReactiveObject(target, callback) {
  const proxy = new Proxy(target, {
    set(obj, prop, value) {
      if (value !== obj[prop]) {
        const prev = obj[prop];
        obj[prop] = value;
        callback(`${prop}ê°€ [#{prev}] >> [${value}] ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. `);
      }
      return true;
    },
  });
  return proxy;
}
const a = {
  í˜•ê·œ: "ì†”ë¡œ",
};
const b = createReactiveObject(a, console.log);
b.í˜•ê·œ = "ì†”ë¡œ";
b.í˜•ê·œ = "ì»¤í”Œ";
// í˜•ê·œê°€ [ì†”ë¡œ] >> [ì»¤í”Œ]ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
```
